---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

The character.only usage will not be recognized in current code. Though probably this usage for library is seldom used. It's possible to use this usage with pacman because it can accept a vector of package names, but again it should be less used because user can input package names without quote directly, unless they want the package list generated by program.

    x <- "ggplot2"
    library(x, character.only = TRUE)

match.call doesn't work with p_load, loader will get the function(pkg, name)
use brute force of pattern matching in string instead of language parsing.

p_load_gh need similar process with devtools line, may need to edit in other places. just use devtools instead.

note pacman package itself will be picked up by original code no matter what:
if used pcaman::p_load, will pick up because of ::
if used library(pacman), will pick up because of library.

supported syntax

    pacman::p_load(stringr, units, install = FALSE)
    pacman::p_load(shiny, shinydashboard)

unsupported syntax
- arguments that saved in variable. 

    op <- TRUE
    pacman::p_load(shinyjs, install = op)
    pkgs <- c("dplyr", "tibble")
    pacman::p_load(pkgs, character.only = TRUE)

- similar usage for library cannot be detected with original packrat either

    pkg <- "ggmap"
    library(pkg, character.only = TRUE)

```{r}
library(packrat)
file <- "/Users/xhdong/Projects/ctmm-explorations/shiny/dashboard1/app.R"
exprs <- suppressWarnings(parse(file, n = -1L))
e <- exprs[[3]]
env <- new.env(parent = emptyenv())
call <- e
packrat:::identifyPackagesUsed(e, env)

p <- "pacman::p_load(ggplot2,ctmm)"
p <- "p_load(ggplot2, install = FALSE)"
exprs <- suppressWarnings(parse(text = p, n = -1L))
e <- exprs2[[1]]
call <- e
env <- new.env(parent = emptyenv())
packrat:::identifyPackagesUsed(e, env)

s <- as.character(call)
sParas <- s[2:length(s)]
filterOut <- c("TRUE", "FALSE", "T", "F")
sParas[!sParas %in% filterOut]
```

test
```{r}
packrat:::fileDependencies(file)
packrat:::fileDependencies("tests/test-pacman.R")

```

